import os
import numpy
from collections import *
import pandas as pd
import binascii

def getMatrixFromASM(filename, startindex = 0, pixnum = 5000):
    with open(filename, 'rb') as f:
        f.seek(startindex, 0)
        content = f.read(pixnum)
    hexst = binascii.hexlify(content)
    fh = numpy.array([int(hexst[i:i+2],16) for i in range(0, len(hexst), 2)])
    fh = numpy.uint8(fh)
    return fh

basePath = "/Users/nmchgx/Documents/subtrain/"
mapImage = defaultdict(list)
subtrain = pd.read_csv('subtrainLabels.csv')

index = 0
for item in subtrain.Id:
    index += 1
    print "dealing with {0}th file...".format(str(index))
    filename = basePath + item + ".asm"
    image = getMatrixFromASM(filename, startindex = 0, pixnum = 1400)
    mapImage[item] = image

dataFrameList = []
for sid,imf in mapImage.iteritems():
    standard = {}
    standard["Id"] = sid
    for index,value in enumerate(imf):
        colName = "pix{0}".format(str(index))
        standard[colName] = value
    dataFrameList.append(standard)

df = pd.DataFrame(dataFrameList)
df.to_csv("imageFeature.csv",index=False)
